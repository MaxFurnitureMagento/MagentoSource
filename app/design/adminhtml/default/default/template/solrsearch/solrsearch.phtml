<h2><?php echo Mage::helper('solrsearch')->__('Solr Bridge Indexes') ?></h2><?php$activeSolrCores = $this->getActiveSolrCores();$stores = Mage::app()->getStores();$storesArray = array();		foreach ($stores as $store) {   $storesArray[$store->getId()] = $store;}?><ul style="padding-left: 20px">	<?php foreach($activeSolrCores as $core => $infoArray) : ?>		<li>			<?php 			$storeLabels = array();			$storeIds = explode(',', $infoArray['stores']);						$lukeInfo = $this->getSolrLuke($core);			$productCount = 0;			$websiteid = array();												foreach ($storeIds as $store_id) {				$storeObject = Mage::getModel('core/store')->load($store_id);				$collectionData = $this->getCollectionData($storeObject);								$storeLabels[] = $storeObject->getWebsite()->getName().'-'.$storeObject->getName().'('.$collectionData['productCount'].' products)';				$productCount += $collectionData['productCount'];				$websiteid[] = $storeObject->getWebsiteId();			}						$percent = round(($lukeInfo['index']['numDocs']*100)/$productCount);						$websiteidstring = @implode(',', array_unique($websiteid));						?>						<?php 				$time = strtotime($lukeInfo['index']['lastModified']);				$date = date('Y-m-d H:i:s', $time);				$datetime = new DateTime(@$date);				$la_time = new DateTimeZone('UTC');				$datetime->setTimezone($la_time);				$lastIndexTime = $datetime->format('Y-m-d H:i:s');								$action = 'NEW';				if ($lukeInfo['index']['numDocs'] > 0) {					$action = 'UPDATE';				}			?>						<h3><?php echo $infoArray['label'] ?> (<i><?php echo Mage::helper('solrsearch')->__('Stores mapped:') ?><?php echo @implode(', ', $storeLabels)?></i>) - <?php echo $productCount.' '.Mage::helper('solrsearch')->__('Magento products') ?>/<span id="store_<?php echo $core?>_solrdocuments"><?php echo $lukeInfo['index']['numDocs']?></span> <?php echo Mage::helper('solrsearch')->__('Solr documents') ?>			<i style="display: none" id="store_<?php echo $core?>_timeremained_box">(Remained time: <span id="store_<?php echo $core?>_timeremained"></span>)</i>			</h3>						<div id="progress-outer-<?php echo $core?>" style="background: #333;-webkit-border-radius: 13px;height: 20px;width: 100%;padding: 3px;">			    <div id="progress-inner-<?php echo $core?>" style="background: orange;width: 0%;height: 100%;-webkit-border-radius: 9px;"></div>				<script type="text/javascript">					$('progress-inner-<?php echo $core?>').setStyle({width:(<?php echo $percent?>) + '%'});					$('progress-inner-<?php echo $core?>').update((<?php echo $percent?>) + '% finished');				</script>			</div>						<input type="hidden" id="store_<?php echo $core?>_numberofproducts" value="<?php echo $productCount?>" />			<input type="hidden" id="store_<?php echo $core?>_totalpages" value="<?php echo $this->getTotalPages(trim($websiteidstring,','))?>" />			<input type="hidden" id="store_<?php echo $core?>_currentpage" value="1" />			<input type="hidden" id="store_<?php echo $core?>_percent" value="%" />			<input type="hidden" id="store_<?php echo $core?>_estimatedtime" value="0" />			<input type="hidden" id="store_<?php echo $core?>_lastindextime" value="<?php echo $lastIndexTime?>" />			<input type="hidden" id="store_<?php echo $core?>_action" value="<?php echo $action?>" />			<input type="hidden" id="store_<?php echo $core?>_numdocs" value="<?php echo $lukeInfo['index']['numDocs']?>" />			<input type="hidden" id="store_<?php echo $core?>_numdocs" value="<?php echo $lukeInfo['index']['numDocs']?>" />			<input type="hidden" id="store_<?php echo $core?>_stores" value="<?php echo $infoArray['stores']?>" />			<input type="hidden" id="store_<?php echo $core?>_websiteid" value="<?php echo $websiteidstring?>" />						<button style="" onclick="solrsearch_admin_ajax_process(1,'<?php echo $core?>')" class="scalable add" type="button" title="Add Product"><span><span><span>Update index</span></span></span></button>			<button style="" onclick="solrsearch_admin_ajax_empty('<?php echo $core?>')" class="scalable add" type="button" title="Empty index"><span><span><span>Empty index</span></span></span></button>				</li>	<?php endforeach; ?></ul><script type="text/javascript">	function solrsearch_admin_ajax_process(currentpage, solrcore){				new Ajax.Request(			'<?php echo trim(Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB),'/');?>/index.php/search/adminhtml_solrsearch/process/',{				parameters:{					page: currentpage, 					totalpage: $('store_'+solrcore+'_totalpages').value, 					productcount: $('store_'+solrcore+'_numberofproducts').value,					core: solrcore,					estimatedtime: $('store_'+solrcore+'_estimatedtime').value,					lastindextime: $('store_'+solrcore+'_lastindextime').value,					action: $('store_'+solrcore+'_action').value,					numDocs: $('store_'+solrcore+'_numdocs').value,					stores: $('store_'+solrcore+'_stores').value,					website: $('store_'+solrcore+'_websiteid').value				},				evalJSON:'force',				onCreate: function(response) {					//do something				},				onSuccess: function(response) {					//Do something				},				onFailure: function(response) {					//do some thing				},				onComplete: function(response) {					var json = response.responseText.evalJSON();						$('store_'+solrcore+'_percent').value = json.percent + '%';					$('progress-inner-'+solrcore).setStyle({width:(json.percent) + '%'});					$('progress-inner-'+solrcore).update((json.percent) + '% finished');										$('store_'+solrcore+'_solrdocuments').update(json.documents);					$('store_'+solrcore+'_timeremained').update(json.remainedtime);					$('store_'+solrcore+'_estimatedtime').value = json.estimatedtime;					$('store_'+solrcore+'_numdocs').value = json.numdocs;					$('store_'+solrcore+'_action').value = json.action;					$('store_'+solrcore+'_timeremained_box').show();										if(json.continueprocess == 'yes') {												solrsearch_admin_ajax_process(json.nextpage, solrcore);											}else{						$('store_'+solrcore+'_timeremained_box').hide();					}								}			}		);	}		function solrsearch_admin_ajax_empty(solrcore) {		new Ajax.Request(			'<?php echo trim(Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB),'/');?>/index.php/search/adminhtml_solrsearch/emptyindex/',{				parameters:{					core: solrcore				},				evalJSON:'force',				onCreate: function(response) {					//do something				},				onSuccess: function(response) {					//Do something				},				onFailure: function(response) {					//do some thing				},				onComplete: function(response) {					window.location.reload();						}			}		);	}</script>